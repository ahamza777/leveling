<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Quest PWA</title>

<link rel="manifest" href="manifest.json">

<style>
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:#0a0a0f;
    color:white;
    text-align:center;
}
.panel{
    background:#111;
    padding:25px;
    margin:20px auto;
    border-radius:20px;
    border:2px solid #00f0ff;
    width:360px;
}
input{margin:5px;padding:8px;width:90%;border-radius:8px;border:none;background:#1a1a1a;color:white;}
button{margin:10px;padding:10px 20px;border:none;border-radius:8px;background:#00f0ff;font-weight:bold;cursor:pointer;}
.quest-card{border:2px solid #00f0ff;margin:8px;padding:10px;border-radius:12px;cursor:pointer;}
.quest-card.active{background:#00f0ff;color:black;}
.progress-bar{width:300px;height:20px;background:#222;border-radius:10px;margin:10px auto;overflow:hidden;}
.progress-fill{height:100%;width:0%;background:#00f0ff;transition:0.5s;}
</style>
</head>
<body>

<div class="panel">
<h2>Quest System PWA</h2>
<input id="username" placeholder="Name">
<div id="questInputs"></div>
<button onclick="addQuestInput()">+ Add Quest</button>
<button onclick="startApp()">Activate</button>
</div>

<div class="panel">
<h3 id="welcome"></h3>
<p>Level: <span id="level">0</span></p>
<p>Total EXP: <span id="totalExp">0</span></p>
<div class="progress-bar"><div class="progress-fill" id="expBar"></div></div>
<div id="questList"></div>
</div>

<script>

let quests=[],completed=[],totalExp=0,level=0,username="";

/* Register Service Worker */
if("serviceWorker" in navigator){
    navigator.serviceWorker.register("sw.js");
}

/* Save / Load */
function saveData(){
    localStorage.setItem("questData",JSON.stringify({quests,completed,totalExp,level,username}));
}
function loadData(){
    let data=JSON.parse(localStorage.getItem("questData"));
    if(data){
        quests=data.quests||[];
        completed=data.completed||[];
        totalExp=data.totalExp||0;
        level=data.level||0;
        username=data.username||"";
        document.getElementById("welcome").innerText="Welcome "+username;
        renderQuests();
    }
}

/* Add Quest */
function addQuestInput(){
    let div=document.createElement("div");
    div.innerHTML=`
        <input placeholder="Quest Name">
        <input type="number" placeholder="EXP">
        <input type="time">
    `;
    document.getElementById("questInputs").appendChild(div);
}

/* Start */
function startApp(){
    username=document.getElementById("username").value;
    if(!username) return alert("Enter name");

    let inputs=document.querySelectorAll("#questInputs div");
    quests=[];
    inputs.forEach(div=>{
        let name=div.children[0].value;
        let exp=parseInt(div.children[1].value);
        let time=div.children[2].value;
        if(name && exp && time){
            quests.push({name,exp,time});
        }
    });

    saveData();
    document.getElementById("welcome").innerText="Welcome "+username;
    renderQuests();
    sendQuestsToSW();
}

/* Render */
function renderQuests(){
    let list=document.getElementById("questList");
    list.innerHTML="";
    quests.forEach((q,i)=>{
        let card=document.createElement("div");
        card.className="quest-card";
        if(completed.includes(i)) card.classList.add("active");
        card.innerHTML=`${q.name} (${q.exp} EXP) - ${q.time}`;
        card.onclick=()=>toggleQuest(i);
        list.appendChild(card);
    });
    updateExp();
}

function toggleQuest(i){
    if(completed.includes(i)){
        completed=completed.filter(x=>x!==i);
        totalExp-=quests[i].exp;
    }else{
        completed.push(i);
        totalExp+=quests[i].exp;
    }
    updateExp();
    saveData();
}

function updateExp(){
    document.getElementById("totalExp").innerText=totalExp;
    document.getElementById("level").innerText=level;
    let totalPossible=quests.reduce((s,q)=>s+q.exp,0);
    let percent=totalPossible?(totalExp/totalPossible)*100:0;
    document.getElementById("expBar").style.width=percent+"%";
}

/* Send quest schedule to Service Worker */
function sendQuestsToSW(){
    if(navigator.serviceWorker.controller){
        navigator.serviceWorker.controller.postMessage({quests});
    }
}

loadData();
addQuestInput();

</script>
</body>
</html>

